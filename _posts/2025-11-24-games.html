---
permalink: /games
---
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="title" content="Minigames üé≤">
    <meta name="description" content="Minigames üé≤">

    <title>Minigames üé≤  - eduardogarcia.xyz</title>

    <style type="text/css">
      :root {
        /* https://material.io/design/color/the-color-system.html#tools-for-picking-colors */
        --m-blue-900: #0d47a1;
        --m-yellow-600: #fdd835;

        --black: #000000;
        --white: #ffffff;

        /* https://colorhunt.co/palette/f2efe79acbd048a6a7006a71 */
        --beige: #F2EFE7;
        --light-teal: #9ACBD0;
        --teal: #48A6A7;
        --dark-teal: #006A71;
      }

      html {
        font-size: 2.5vmin;
      }

      @media (width <= 1024px) {
        html {
          font-size: 1.75vmin;
        }
      }

      @media (orientation: portrait) {
        html {
          font-size: 1.25vmin;
        }
      }

      body {
        font-family: 'Helvetica Neue', Helvetica, sans-serif;
        margin: 0;
      }

      main {
        display: flex;
        flex: 1 0 auto;
        flex-direction: row;
        flex-wrap: wrap;
      }

      button {
        border: .5rem solid var(--beige);
        background-color: var(--beige);
        color: var(--dark-teal);
        cursor: pointer;
        font-weight: bold;
        font-size: 2.5rem;
        height: 25vh;
        height: 25dvh;
        text-align: center;
        vertical-align: middle;
        width: 20vw;
        width: 20dvw;
      }

      button:hover {
        border-color: var(--light-teal);
      }

      .selected {
        background-color: var(--light-teal);
        border-color: var(--light-teal);
      }

      .success {
        background-color: var(--light-teal);
        border-color: var(--light-teal);
        opacity: .25;
        pointer-events: none;
      }

      [data-type=emoji] {
        font-size: 5rem;
      }
    </style>
  </head>

  <body>
    <main></main>

    <script>
      // From:
      // * https://github.com/thewarpaint/caracteres/blob/master/assets/main.js
      // * https://github.com/thewarpaint/caracteres/blob/master/_includes/early-scripts.html

      const Globals = {
        // languages: ["en-UK", "en-US", "en-GB", "en"]
        languages: ["es-MX", "es-ES", "es"]
      };

      const animals = [
        {
          cardId: 'cat',
          emoji: 'üê±',
          i18n: {
            en: 'cat',
            es: 'gato',
          },
        },
        {
          cardId: 'dog',
          emoji: 'üê∂',
          i18n: {
            en: 'dog',
            es: 'perro',
          },
        },
        {
          cardId: 'monkey',
          emoji: 'üêµ',
          i18n: {
            en: 'monkey',
            es: 'mono',
          },
        },
        {
          cardId: 'bear',
          emoji: 'üêª',
          i18n: {
            en: 'bear',
            es: 'oso',
          },
        },
        {
          cardId: 'mouse',
          emoji: 'üê≠',
          i18n: {
            en: 'mouse',
            es: 'rat√≥n',
          },
        },
        {
          cardId: 'tiger',
          emoji: 'üêØ',
          i18n: {
            en: 'tiger',
            es: 'tigre',
          },
        },
        {
          cardId: 'elephant',
          emoji: 'üêò',
          i18n: {
            en: 'elephant',
            es: 'elefante',
          },
        },
        {
          cardId: 'lion',
          emoji: 'ü¶Å',
          i18n: {
            en: 'lion',
            es: 'le√≥n',
          },
        },
        {
          cardId: 'bunny',
          emoji: 'üê∞',
          i18n: {
            en: 'bunny',
            es: 'conejo',
          },
        },
        {
          cardId: 'pig',
          emoji: 'üê∑',
          i18n: {
            en: 'pig',
            es: 'cerdo',
          },
        },
        // {
        //   cardId: 'fox',
        //   emoji: 'ü¶ä',
        //   i18n: {
        //     en: 'fox',
        //     es: 'zorro',
        //   },
        // },
        // {
        //   cardId: 'horse',
        //   emoji: 'üê¥',
        //   i18n: {
        //     en: 'horse',
        //     es: 'caballo',
        //   },
        // },
        // {
        //   cardId: 'cow',
        //   emoji: 'üêÆ',
        //   i18n: {
        //     en: 'cow',
        //     es: 'vaca',
        //   },
        // },
      ]

      document.addEventListener('DOMContentLoaded', function (event) {
        FeatureDetection.init();
        Games.init();
      });

      // TODO: Refactor to proper class
      const FeatureDetection = (function () {
        function FeatureDetection() {}

        FeatureDetection.prototype.hasSpeechSynthesis = function () {
          return 'speechSynthesis' in window;
        };

        FeatureDetection.prototype.hasLocalStorage = function () {
          // From https://github.com/Modernizr/Modernizr/blob/master/feature-detects/storage/localstorage.js#L40
          var mod = 'modernizr';

          try {
            localStorage.setItem(mod, mod);
            localStorage.removeItem(mod);
            return true;
          } catch (e) {
            return false;
          }
        };

        FeatureDetection.prototype.init = function () {
          var features = [
            {
              detector: this.hasSpeechSynthesis,
              aClass: 'body--has-speech-synthesis'
            },
            {
              detector: this.hasLocalStorage,
              aClass: 'body--has-local-storage'
            }
          ];

          // TODO: Refactor to use `classList`
          var bodyClasses = [];

          for(var i = 0; i < features.length; i++) {
            if (features[i].detector()) {
              bodyClasses.push(features[i].aClass);
            }
          }

          document.body.className += ' ' + bodyClasses.join(' ');
        };

        return new FeatureDetection();
      })();

      // TODO: Refactor to proper class
      const Console = (function () {
        function Console() {
          this.element = document.querySelector('.console');
        }

        Console.prototype.log = function log(string) {
          console.log(string);

          if (this.element) {
            this.element.innerHTML += '\n‚áí ' + string;
          }
        };

        return new Console();
      })();

      // TODO: Refactor to proper class
      const Synth = (function () {
        function Synth() {
          this.voices = {};
          this.onVoicesChangedCallback = function () {}; // noop
        }

        Synth.prototype.init = function (onVoicesChangedCallback) {
          if (FeatureDetection.hasSpeechSynthesis()) {
            if (typeof speechSynthesis.onvoiceschanged !== 'undefined') {
              speechSynthesis.onvoiceschanged = this.onVoicesChanged;
            }

            if (typeof onVoicesChangedCallback === 'function') {
              this.onVoicesChangedCallback = onVoicesChangedCallback;
            }

            this.onVoicesChanged();
          }
        };

        Synth.prototype.onVoicesChanged = function () {
          speechSynthesis.getVoices().forEach(function (voice) {
            var normalizedLanguageId = voice.lang.replace(/_/g, '-');

            if (!window.Synth.voices[normalizedLanguageId]) {
              Console.log('Adding voice for language ' + normalizedLanguageId + '.');
              window.Synth.voices[normalizedLanguageId] = voice;
            }
          });

          window.Synth.onVoicesChangedCallback();
        };

        Synth.prototype.speakInLanguageIds = function (word, languageIds) {
          for (var i = 0; i < languageIds.length; i++) {
            if (window.Synth.voices[languageIds[i]]) {
              this.speak(word, this.voices[languageIds[i]]);

              return;
            }
          }

          Console.log('No voice available for languages: ' + languageIds.join(',') + '.');
        };

        Synth.prototype.speakInLanguageId = function (word, languageId) {
          if (!this.voices[languageId]) {
            Console.log('No voice available for language: ' + languageId + '.');
            return;
          }

          this.speak(word, this.voices[languageId]);
        };

        Synth.prototype.speak = function (word, voice) {
          Console.log('Speaking "' + word + '" in ' + voice.lang + '.');

          var utterance;

          if (!window.myUtterances) {
            window.myUtterances = {};
          }

          if (window.myUtterances[word]) {
            utterance = window.myUtterances[word];
          } else {
            utterance = new SpeechSynthesisUtterance(word);
            utterance.voice = voice;
            utterance.lang = voice.lang;
            window.myUtterances[word] = utterance;
          }

          speechSynthesis.speak(utterance);
        };

        return new Synth();
      })();

      const Games = (function () {
        function Games() {
          this.mainLanguage = null;
          this.hasMainLanguageVoice = false;
          this.showNerdStuffBtn = null;
          // { id, type, animal }
          this.state = {
            activeCard: null,
          };
          this.language = 'es';
        }

        Games.prototype.init = function () {
          Console.log('Version: ' + Globals.version);

          Synth.init(this.onVoicesChanged);

          let innerHtml = '';
          let animalsShuffled = Array.from(animals);
          shuffleArray(animalsShuffled);

          const emojiAnimalsHtmls = animalsShuffled
            .map((animal) =>
              window.Games.getCardInnerHtml(animal, 'emoji', window.Games.language)
            );

          shuffleArray(animalsShuffled);

          const wordAnimalsHtmls = animalsShuffled
            .map((animal) =>
              window.Games.getCardInnerHtml(animal, 'word', window.Games.language)
            );

          const emojiFirst = Math.random() > 0.5;

          for (let i = 0; i < animalsShuffled.length; i++) {
            if (emojiFirst) {
              innerHtml += emojiAnimalsHtmls[i];
              innerHtml += wordAnimalsHtmls[i];
            } else {
              innerHtml += wordAnimalsHtmls[i];
              innerHtml += emojiAnimalsHtmls[i];
            }
          }

          document.querySelector('main').innerHTML = document.querySelector('main').innerHTML + innerHtml;

          if (FeatureDetection.hasSpeechSynthesis()) {
            this.addSpeakButtonClickListeners();
          }

          // this.showNerdStuffBtn = document.getElementById('show-nerd-stuff-btn');
          // this.showNerdStuffBtn.addEventListener('click', window.Chocolate.onShowNerdStuffClick.bind(this));
        };

        Games.prototype.onVoicesChanged = function () {
          for (var i = 0; i < Globals.languages.length; i++) {
            window.Games.hasMainLanguageVoice =
              typeof window.Synth.voices[Globals.languages[i]] !== 'undefined';

            if (window.Games.hasMainLanguageVoice) {
              Console.log('Selecting voice for language ' + Globals.languages[i] + '.');
              window.Games.mainLanguage = Globals.languages[i];
              document.body.classList.add('body--has-voice-available');

              break;
            }
          }

          if (!window.Games.hasMainLanguageVoice) {
            Console.log('No voice available for languages: ' + Globals.languages.join(',') + '.');
          }
        };

        Games.prototype.speak = function (word) {
          window.Synth.speakInLanguageId(word, window.Games.mainLanguage);
        };

        Games.prototype.onCardClick = function (e) {
          window.Games.speak(this.getAttribute('data-speak'));

          const cardElement = e.target;

          const clickedCard = {
            id: cardElement.id,
            type: cardElement.dataset.type,
            animal: cardElement.dataset.animal,
          };

          window.Games.state = window.Games.applyNextState(window.Games.state, clickedCard);
        };


        Games.prototype.applyNextState = function (oldState, clickedCard) {
          // State transitions (state + event => new state):
          // * start + first click => selected
          // * start + second click, unrelated => start
          // * start + second click, same card => start
          // * start + second click, match => success
          // * selected + second click, unrelated => start
          // * selected + second click, match => success

          const $clickedCard = document.getElementById(clickedCard.id);
          const initialState = {
            activeCard: null,
          };
          let newState = {};

          // TODO: Refactor classList updates into a returned closure to be executed by caller
          if (oldState.activeCard === null) {
            // First click
            // Transition: start + first click => selected
            $clickedCard.classList.add('selected');

            newState = {
              activeCard: clickedCard,
            };
          } else {
            // Second click
            const isSameCard = oldState.activeCard.id === clickedCard.id;
            const isMatch = oldState.activeCard.animal === clickedCard.animal;
            const $activeCard = document.getElementById(oldState.activeCard.id);

            if (isSameCard) {
              // Transition:  start + second click, same card => start
              $activeCard.classList.remove('selected');

              newState = initialState;
            } else if (isMatch) {
              // Transition: selected + second click, match => success
              $activeCard.classList.remove('selected');
              $activeCard.classList.add('success');

              // Transition: start + second click, match => success
              $clickedCard.classList.add('success');

              newState = initialState;
            } else {
              // Transition: start + second click, unrelated => start (no-op)
              // Transition: selected + second click, unrelated => start
              $activeCard.classList.remove('selected');

              newState = initialState;
            }
          }

          return newState;
        };

        Games.prototype.getCardInnerHtml = function (cardData, type, language) {
          const {cardId, emoji} = cardData;
          const speakText = cardData.i18n[language];
          const buttonText = type === 'emoji' ? emoji : speakText;

          return `
            <button
              id="button-${type}-${cardId}"
              data-type="${type}"
              data-animal="${cardId}"
              data-speak="${speakText}"
            >
              ${buttonText}
            </button>
          `;
        };

        Games.prototype.onListenableLinkClick = function () {
          if (this.getAttribute('data-lang')) {
            var languageIds = this.getAttribute('data-lang').split(',');
            window.Synth.speakInLanguageIds(this.innerText, languageIds);
          } else {
            window.Games.speak(this.innerText);
          }
        };

        Games.prototype.addSpeakButtonClickListeners = function () {
          Array.prototype.slice.apply(document.querySelectorAll('[data-speak]'))
            .forEach(function (button) {
              button.addEventListener('click', window.Games.onCardClick);
            });
        };

        Games.prototype.onShowNerdStuffClick = function () {
          document.getElementById('console').classList.remove('console--hidden');
          this.showNerdStuffBtn.classList.add('btn--hidden');
        };

        return new Games();
      })();

      // Randomize array in-place using Durstenfeld shuffle algorithm
      // https://stackoverflow.com/a/12646864
      function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [array[i], array[j]] = [array[j], array[i]];
        }
      }

      window.Games = Games;
      window.Synth = Synth;
    </script>
  </body>
</html>